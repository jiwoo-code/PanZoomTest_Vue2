1. Vue â”€ HistoryPopup.vue

<script>
import axios from '@/plugins/axios';

export default {
  props: { canEditRemark: Boolean },

  data() {
    return {
      gridApi     : null,
      hasChanged  : false,         // ì €ì¥ ë²„íŠ¼ í™œì„± ì—¬ë¶€
      columnDefs: [
        { field:'id', width:80 },
        {
          field: 'remark',
          headerName: 'ë¹„ê³ ',
          editable : () => this.canEditRemark,
          cellEditor: 'agLargeTextCellEditor',
          cellEditorParams:{ cols:28, rows:3 },
          cellClassRules: { 'cell-changed': p => !!p.data.changed }
        }
      ],
      gridOptions: {
        defaultColDef:{ resizable:true, sortable:true },
        onCellValueChanged: p => this.markChanged(p)
      }
    };
  },

  methods: {
    onGridReady(p) { this.gridApi = p.api; },

    /* ì…€ í¸ì§‘ ì‹œ changed í”Œë˜ê·¸ ì§€ì • */
    markChanged(p) {
      if (p.colDef.field === 'remark' && this.canEditRemark) {
        p.data.changed = true;
        this.hasChanged = true;
        p.api.refreshCells({ rowNodes:[p.node], columns:['remark'] });
      }
    },

    /* changed í–‰ ëª¨ìœ¼ê¸° */
    collectChanged() {
      const list = [];
      this.gridApi.forEachNode(n => {
        if (n.data.changed) list.push({ id:n.data.id, remark:n.data.remark });
      });
      return list;
    },

    /* ğŸ‘‰ ì €ì¥ ë²„íŠ¼ */
    async saveChanged() {
      const payload = this.collectChanged();
      if (!payload.length) return;

      try {
        await axios.post('/api/history/updateRemarks', payload);   // POST + JSON
        this.clearChanged();
        this.$toast.success('ì €ì¥ ì™„ë£Œ');
      } catch (e) {
        this.$toast.error('ì €ì¥ ì‹¤íŒ¨');
        console.error(e);
      }
    },

    /* ì €ì¥ ì„±ê³µ í›„ ì´ˆê¸°í™” */
    clearChanged() {
      this.gridApi.forEachNode(n => { n.data.changed = false; });
      this.hasChanged = false;
      this.gridApi.refreshCells({ force:true });
    }
  }
};
</script>

<style scoped>
.cell-changed { background:#fff5cc !important; }
</style>


---

2. Java ë°±ì—”ë“œ

2-1. DTO

@Data @AllArgsConstructor @NoArgsConstructor
public class RemarkDTO {
    private Long   id;
    private String remark;
}

2-2. Controller

@RestController
@RequestMapping("/api/history")
@RequiredArgsConstructor
public class HistoryController {

    private final HistoryService historyService;

    /** POST /api/history/updateRemarks
     *  Body : [ { "id":1, "remark":"..." }, ... ]
     */
    @PostMapping("/updateRemarks")
    public int updateRemarks(@RequestBody List<RemarkDTO> list) {
        return historyService.updateRemarks(list);   // ìˆ˜ì •ëœ row ìˆ˜ ë°˜í™˜
    }
}

2-3. Service

@Service
@RequiredArgsConstructor
public class HistoryService {

    private final HistoryMapper historyMapper;

    @Transactional
    public int updateRemarks(List<RemarkDTO> list) {
        if (list.isEmpty()) return 0;
        return historyMapper.batchUpdate(list);
    }
}

2-4. Mapper ì¸í„°í˜ì´ìŠ¤

@Mapper
public interface HistoryMapper {
    int batchUpdate(@Param("list") List<RemarkDTO> list);
}

2-5. MyBatis XML

<!-- resources/mapper/HistoryMapper.xml -->
<mapper namespace="com.example.HistoryMapper">

  <update id="batchUpdate">
    <foreach collection="list" item="r" separator=";">
      UPDATE history
      SET    remark = #{r.remark}
      WHERE  id     = #{r.id}
    </foreach>
  </update>

</mapper>


---

ì „ì²´ íë¦„

1. Vue
í¸ì§‘ â†’ row.changed = true â†’ ì €ì¥ â†’ axios.post('/api/history/updateRemarks', changedRows)


2. Spring Controller
@RequestBody List<RemarkDTO> ë¡œ ìˆ˜ì‹  â†’ Service í˜¸ì¶œ


3. Service (íŠ¸ëœì­ì…˜) â†’ Mapper


4. MyBatis <foreach> ë¡œ UPDATE â€¦ ; UPDATE â€¦ (ë°°ì¹˜)


5. ì„±ê³µ ì‹œ Vue ì—ì„œ clearChanged() â†’ ì…€ í•˜ì´ë¼ì´íŠ¸ ë° í”Œë˜ê·¸ í•´ì œ



ì´ë ‡ê²Œ í•˜ë©´ í–‰ ìˆ˜ì • ì—¬ë¶€ í‘œì‹œÂ·ì¼ê´„ ì €ì¥ì´ changed í”Œë˜ê·¸ ê¸°ì¤€ìœ¼ë¡œ ê°„ê²°í•˜ê²Œ ë™ì‘í•©ë‹ˆë‹¤.

